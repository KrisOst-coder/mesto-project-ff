(()=>{"use strict";var e=/^[а-яА-Яa-zA-ZЁё\-\s]*$/,t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"inactive__popup__button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},n=function(e,n){e.some((function(e){return"True"!==o(e)}))?(n.disabled=!0,n.classList.add(t.inactiveButtonClass)):(n.disabled=!1,n.classList.remove(t.inactiveButtonClass))};function o(t){var n=t.value;return t.validity.valid?"url"===t.name||n.match(e)?"True":t.dataset.errorMessage:(t.setCustomValidity(""),"False")}var r=function(e,n,o){e.classList.add(t.inputErrorClass),o.textContent=n,o.classList.add(t.errorClass)},c=function(e,n){e.classList.remove(t.inputErrorClass),n.classList.remove(t.errorClass),n.textContent=""};function a(e){"Escape"===e.key&&l(document.querySelector(".popup_is-opened"))}function u(e,o){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a),o.addEventListener("click",(function(o){var r,a,u;l(e),r=e,a=Array.from(r.querySelectorAll(t.inputSelector)),u=r.querySelector(t.submitButtonSelector),console.log(r),console.log(u),a.forEach((function(e){var t=r.querySelector(".".concat(e.classList[1],"-error"));c(e,t)})),u&&n(a,u)}))}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}var i={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"1b672ea5-50fb-43e7-92f6-8a26aeae5f47","Content-Type":"application/json"}},s=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},d=document.querySelector("#card-template").content,p=document.querySelector(".popup_agree_with_delete");function _(e,t,n){var o=e.name,r=e.link,c=d.querySelector(".places__item").cloneNode(!0),a=c.querySelector(".card__image");if(a.alt=o,a.src=r,c.querySelector(".card__title").textContent=o,a.addEventListener("click",(function(){return n(r,o)})),c.querySelector(".likes-count").textContent=e.likes.length,t===e.owner._id){console.log("in");var _=c.querySelector(".card__delete-button"),m=document.querySelector(".delete__close"),f=document.querySelector(".popup__button_agree_with_delete");_.addEventListener("click",(function(){u(p,m),f.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(i.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:i.headers}).then(s)).then((function(e){c.remove(),l(p)}))}))}))}else c.querySelector(".card__delete-button").style.display="none";var v=c.querySelector(".card__like-button");return e.likes.some((function(e){return e._id===t}))&&v.classList.add("card__like-button_is-active"),v.addEventListener("click",(function(){return function(e,t,n){var o;Array.from(t.classList).includes("card__like-button_is-active")?(t.classList.remove("card__like-button_is-active"),(o=e._id,fetch("".concat(i.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:i.headers}).then(s)).then((function(e){n.querySelector(".likes-count").textContent=e.likes.length}))):(t.classList.add("card__like-button_is-active"),function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then(s)}(e._id).then((function(e){n.querySelector(".likes-count").textContent=e.likes.length})))}(e,v,c)})),c}document.querySelector("#card-template").content;var m=document.querySelector(".places__list"),f=document.querySelector(".profile__edit-button"),v=document.querySelector(".popup_type_edit"),y=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),b=document.querySelector(".edit__close"),q=document.querySelector(".new__close"),g=document.querySelector(".image__close"),L=document.querySelector(".popup__input_type_name"),k=document.querySelector(".profile__title"),E=document.querySelector(".popup__input_type_description"),C=document.querySelector(".profile__description"),x=document.querySelector(".popup__image"),w=document.querySelector(".popup__caption"),A=(document.querySelector(".popup_agree_with_delete"),document.querySelector(".delete__close"),document.querySelector(".popup_update_avatar")),T=document.querySelector(".avatar__close"),U=document.forms["edit-profile"],B=document.forms["new-place"],D=document.forms["update-avatar"],P=B.querySelector(".popup__button"),N=D.querySelector(".popup__button");console.log(P.disabled),P.disabled=!0,N.disabled=!0;var O="";fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then(s).then((function(e){k.textContent=e.name,C.textContent=e.about,$.style["background-image"]="url(".concat(e.avatar,")"),O=e._id})).catch((function(e){console.log(e)})),fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then(s).then((function(e){e.forEach((function(e){m.append(_(e,O,F))}))})).catch((function(e){console.log(e)})),f.addEventListener("click",(function(e){u(v,b),L.value=k.textContent,E.value=C.textContent})),y.addEventListener("click",(function(e){var t=B.elements["place-name"],n=B.elements.url;t.value="",n.value="",u(h,q)}));var j=U.elements.name,J=U.elements.description,z=U.querySelector(".popup__button");function F(e,t){x.src=e,x.alt=t,w.textContent=t,u(S,g)}U.addEventListener("submit",(function(e){z.textContent="Сохранение...",z.disabled=!1,e.preventDefault();var t,n=j.value,o=J.value;(t=JSON.stringify({name:n,about:o}),fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:t}).then(s)).then((function(e){k.textContent=e.name,C.textContent=e.about,z.disabled=!0,l(v)})).catch((function(e){console.log(e)})).finally((function(){z.textContent="Сохранить"}))}));var H=B.elements["place-name"],M=B.elements.url,V=B.querySelector(".popup__button");B.addEventListener("submit",(function(e){e.preventDefault(),function(e){return fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:e}).then(s)}(JSON.stringify({name:H.value,link:M.value})).then((function(e){m.prepend(_(e,O,F)),V.disabled=!0,l(h)})).catch((function(e){console.log(e)}))})),[v,h,S].forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&l(e)}))}));var Z=document.querySelector(".profile__image"),$=document.querySelector(".profile__image"),G=D.elements.url,I=D.querySelector(".popup__button");Z.addEventListener("click",(function(e){u(A,T)})),D.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=JSON.stringify({avatar:G.value}),fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:t}).then(s)).then((function(e){$.style["background-image"]="url(".concat(e.avatar,")"),G.value="",I.disabled=!0,l(A)})).catch((function(e){console.log(e)}))})),Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var a=Array.from(e.querySelectorAll(t.inputSelector)),u=e.querySelector(t.submitButtonSelector);a.forEach((function(t){t.addEventListener("input",(function(){var l,i,s,d=e.querySelector(".".concat(t.classList[1],"-error"));i=d,"True"===(s=o(l=t))?c(l,i):"False"===s?(console.log("here1"),r(l,l.validationMessage,i)):(console.log("here"),r(l,s,i)),n(a,u)}))}))}(e)}))})();