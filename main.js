(()=>{"use strict";var e=/^[а-яА-Яa-zA-ZЁё\-\s]*$/,t=function(e,t,o){e.some((function(e){return"True"!==n(e)}))?(t.disabled=!0,t.classList.add(o.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(o.inactiveButtonClass))};function n(t){var n=t.value;return t.validity.valid?"url"===t.name||n.match(e)?"True":t.dataset.errorMessage:(t.setCustomValidity(""),"False")}var o=function(e,t,n,o){e.classList.add(o.inputErrorClass),n.textContent=t,n.classList.add(o.errorClass)},r=function(e,t,n){e.classList.remove(n.inputErrorClass),t.classList.remove(n.errorClass),t.textContent=""};function c(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function a(e,n,o){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c),n.addEventListener("click",(function(n){u(e),function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),c=e.querySelector(n.submitButtonSelector);console.log(e),console.log(c),o.forEach((function(t){var o=e.querySelector(".".concat(t.classList[1],"-error"));r(t,o,n)})),c&&t(o,c,n)}(e,o)}))}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}var l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-10",headers:{authorization:"1b672ea5-50fb-43e7-92f6-8a26aeae5f47","Content-Type":"application/json"}},i=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},s=document.querySelector("#card-template").content,d=document.querySelector(".popup_agree_with_delete");function p(e,t,n){var o=e.name,r=e.link,c=s.querySelector(".places__item").cloneNode(!0),p=c.querySelector(".card__image");if(p.alt=o,p.src=r,c.querySelector(".card__title").textContent=o,p.addEventListener("click",(function(){return n(r,o)})),c.querySelector(".likes-count").textContent=e.likes.length,t===e.owner._id){console.log("in");var _=c.querySelector(".card__delete-button"),f=document.querySelector(".delete__close"),m=document.querySelector(".popup__button_agree_with_delete");_.addEventListener("click",(function(){a(d,f),m.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers}).then(i)).then((function(e){c.remove(),u(d)}))}))}))}else c.querySelector(".card__delete-button").style.display="none";var v=c.querySelector(".card__like-button");return e.likes.some((function(e){return e._id===t}))&&v.classList.add("card__like-button_is-active"),v.addEventListener("click",(function(){return function(e,t,n){var o;Array.from(t.classList).includes("card__like-button_is-active")?(t.classList.remove("card__like-button_is-active"),(o=e._id,fetch("".concat(l.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:l.headers}).then(i)).then((function(e){n.querySelector(".likes-count").textContent=e.likes.length}))):(t.classList.add("card__like-button_is-active"),function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then(i)}(e._id).then((function(e){n.querySelector(".likes-count").textContent=e.likes.length})))}(e,v,c)})),c}document.querySelector("#card-template").content;var _=document.querySelector(".places__list"),f=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),v=document.querySelector(".profile__add-button"),y=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),S=document.querySelector(".edit__close"),b=document.querySelector(".new__close"),q=document.querySelector(".image__close"),L=document.querySelector(".popup__input_type_name"),g=document.querySelector(".profile__title"),C=document.querySelector(".popup__input_type_description"),k=document.querySelector(".profile__description"),E=document.querySelector(".popup__image"),x=document.querySelector(".popup__caption"),w=(document.querySelector(".popup_agree_with_delete"),document.querySelector(".delete__close"),document.querySelector(".popup_update_avatar")),A=document.querySelector(".avatar__close"),T=document.forms["edit-profile"],U=document.forms["new-place"],B=document.forms["update-avatar"],D=(U.querySelector(".popup__button"),B.querySelector(".popup__button"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"inactive__popup__button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}),P="";fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then(i).then((function(e){g.textContent=e.name,k.textContent=e.about,V.style["background-image"]="url(".concat(e.avatar,")"),P=e._id,fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then(i).then((function(e){e.forEach((function(e){_.append(p(e,P,J))}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),f.addEventListener("click",(function(e){a(m,S,D),L.value=g.textContent,C.value=k.textContent})),v.addEventListener("click",(function(e){var t=U.elements["place-name"],n=U.elements.url;t.value="",n.value="",a(y,b,D)}));var N=T.elements.name,O=T.elements.description,j=T.querySelector(".popup__button");function J(e,t){E.src=e,E.alt=t,x.textContent=t,a(h,q,D)}T.addEventListener("submit",(function(e){e.preventDefault();var t,n=N.value,o=O.value;(t=JSON.stringify({name:n,about:o}),fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:t}).then(i)).then((function(e){g.textContent=e.name,k.textContent=e.about,j.disabled=!0,j.textContent="Сохранение...",u(m)})).catch((function(e){console.log(e)})).finally((function(){j.textContent="Сохранить",j.disabled=!1}))}));var z=U.elements["place-name"],F=U.elements.url,H=U.querySelector(".popup__button");U.addEventListener("submit",(function(e){e.preventDefault(),function(e){return fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:e}).then(i)}(JSON.stringify({name:z.value,link:F.value})).then((function(e){_.prepend(p(e,P,J)),H.disabled=!0,H.textContent="Сохранение...",u(y)})).catch((function(e){console.log(e)})).finally((function(){H.textContent="Сохранить",H.disabled=!1}))})),[m,y,h].forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&u(e)}))}));var M=document.querySelector(".profile__image"),V=document.querySelector(".profile__image"),Z=B.elements.url,$=B.querySelector(".popup__button");M.addEventListener("click",(function(e){a(w,A,D)})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=JSON.stringify({avatar:Z.value}),fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:t}).then(i)).then((function(e){V.style["background-image"]="url(".concat(e.avatar,")"),Z.value="",$.disabled=!0,$.textContent="Сохранение...",u(w)})).catch((function(e){console.log(e)})).finally((function(){$.textContent="Сохранить",$.disabled=!1}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(c){c.addEventListener("submit",(function(e){e.preventDefault()})),function(e,c){var a=Array.from(e.querySelectorAll(c.inputSelector)),u=e.querySelector(c.submitButtonSelector);a.forEach((function(l){l.addEventListener("input",(function(){var i=e.querySelector(".".concat(l.classList[1],"-error"));(function(e,t,c){var a=n(e);"True"===a?r(e,t,c):"False"===a?(console.log("here1"),o(e,e.validationMessage,t,c)):(console.log("here"),o(e,a,t,c))})(l,i,c),t(a,u,c)}))}))}(c,e)}))}(D)})();